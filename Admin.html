<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Cyber Command</title>
    <script src="sync-manager.js"></script>
    <script src="live-sync.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #7000ff;
            --accent: #ff0055;
            --success: #00ff9d;
            --warning: #ffcc00;
            --danger: #ff0055;
            --bg-dark: #050510;
            --bg-panel: rgba(15, 20, 35, 0.85);
            --text-main: #e0e6ed;
            --text-muted: #94a3b8;
            --border: rgba(0, 242, 255, 0.2);
            --neon-glow: 0 0 10px rgba(0, 242, 255, 0.5);
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; }

        body { 
            margin: 0; 
            font-family: 'Kanit', sans-serif; 
            background-color: var(--bg-dark);
            background-image: 
                linear-gradient(rgba(5, 5, 16, 0.9), rgba(5, 5, 16, 0.9)),
                repeating-linear-gradient(0deg, transparent, transparent 1px, rgba(0, 242, 255, 0.03) 1px, rgba(0, 242, 255, 0.03) 2px),
                repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(0, 242, 255, 0.03) 1px, rgba(0, 242, 255, 0.03) 2px);
            background-size: 100% 100%, 20px 20px, 20px 20px;
            color: var(--text-main); 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }

        .sidebar { 
            width: 260px; 
            background: rgba(10, 15, 30, 0.95); 
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--border);
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
            z-index: 100;
            box-shadow: 5px 0 20px rgba(0,0,0,0.5);
        }

        .brand { 
            font-size: 1.8rem; 
            color: var(--primary); 
            font-weight: bold; 
            margin-bottom: 30px; 
            text-align: center; 
            text-shadow: var(--neon-glow);
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .menu-item { 
            padding: 12px 15px; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            color: var(--text-muted);
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .menu-item:hover, .menu-item.active { 
            background: rgba(0, 242, 255, 0.1); 
            color: var(--primary); 
            border-color: var(--border);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.1);
            transform: translateX(5px);
        }

        .menu-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
        }
        
        .content { flex: 1; padding: 30px; overflow-y: auto; position: relative; }

        .card { 
            background: var(--bg-panel); 
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            padding: 25px; 
            border-radius: 16px; 
            margin-bottom: 25px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); 
            transition: transform 0.3s, box-shadow 0.3s; 
            position: relative;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: -1px; left: -1px; right: -1px; bottom: -1px;
            border-radius: 16px;
            background: linear-gradient(45deg, transparent 40%, rgba(0, 242, 255, 0.1) 50%, transparent 60%);
            z-index: -1;
            pointer-events: none;
        }

        .card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 15px 40px rgba(0, 242, 255, 0.1); 
        }
        
        h2 {
            color: var(--text-main);
            margin-top: 0;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
            display: inline-block;
            text-shadow: 0 0 10px rgba(255,255,255,0.1);
        }

        /* Tables */
        table { width: 100%; border-collapse: separate; border-spacing: 0 5px; margin-top: 15px; }
        th { 
            text-align: left; 
            padding: 15px; 
            color: var(--primary); 
            text-transform: uppercase; 
            font-size: 0.8rem; 
            letter-spacing: 1px; 
            background: rgba(0, 242, 255, 0.05);
            border-radius: 5px;
        }
        td { 
            padding: 15px; 
            background: rgba(255,255,255,0.02); 
            color: #e2e8f0; 
            border-top: 1px solid rgba(255,255,255,0.05);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        tr td:first-child { border-left: 1px solid rgba(255,255,255,0.05); border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
        tr td:last-child { border-right: 1px solid rgba(255,255,255,0.05); border-top-right-radius: 8px; border-bottom-right-radius: 8px; }
        tr:hover td { background: rgba(255,255,255,0.05); }
        
        /* Forms */
        .search-bar, .cyber-input { 
            width: 100%; 
            padding: 12px 15px; 
            background: rgba(0,0,0,0.4); 
            border: 1px solid var(--border); 
            border-radius: 8px; 
            color: white; 
            margin-bottom: 15px; 
            box-sizing: border-box; 
            outline: none;
            transition: 0.3s;
        }
        .search-bar:focus, .cyber-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.2);
        }
        
        /* Buttons */
        .btn-sm { padding: 6px 12px; border-radius: 6px; border: none; cursor: pointer; color: white; font-size: 0.85rem; margin-right: 5px; transition: 0.3s; font-weight: 500; }
        .btn-green { background: linear-gradient(45deg, #059669, #10b981); box-shadow: 0 0 10px rgba(16, 185, 129, 0.3); }
        .btn-red { background: linear-gradient(45deg, #b91c1c, #ef4444); box-shadow: 0 0 10px rgba(239, 68, 68, 0.3); }
        .btn-gray { background: #475569; }
        .btn-primary { background: linear-gradient(45deg, #0284c7, #0ea5e9); box-shadow: 0 0 10px rgba(14, 165, 233, 0.3); }
        
        .btn-sm:hover { transform: translateY(-2px); filter: brightness(1.2); }

        .section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Badges */
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; border: 1px solid transparent; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-warning { background: rgba(245, 158, 11, 0.15); color: #f59e0b; border-color: rgba(245, 158, 11, 0.3); }
        .badge-success { background: rgba(16, 185, 129, 0.15); color: #10b981; border-color: rgba(16, 185, 129, 0.3); }
        .badge-danger { background: rgba(239, 68, 68, 0.15); color: #ef4444; border-color: rgba(239, 68, 68, 0.3); }
        .badge-info { background: rgba(59, 130, 246, 0.15); color: #3b82f6; border-color: rgba(59, 130, 246, 0.3); }
        
        .nav-badge { background: var(--accent); color: white; font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; margin-left: auto; box-shadow: 0 0 8px var(--accent); animation: pulse-neon 2s infinite; }
        
        @keyframes pulse-neon {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 85, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(255, 0, 85, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 85, 0); }
        }

        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #334155; transition: .4s; border-radius: 34px; border: 1px solid #475569; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success); border-color: var(--success); }
        input:checked + .slider:before { transform: translateX(24px); box-shadow: 0 0 10px white; }

        /* Toast */
        .ai-toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
        .ai-toast {
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid var(--primary);
            color: #e2e8f0;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
            display: flex; align-items: center; gap: 15px;
            min-width: 320px;
            animation: slideIn 0.3s ease-out forwards;
            backdrop-filter: blur(10px);
            border-left: 4px solid var(--primary);
        }
        .ai-toast.success { border-left-color: var(--success); border-color: var(--success); box-shadow: 0 0 20px rgba(0, 255, 157, 0.2); }
        .ai-toast.error { border-left-color: var(--danger); border-color: var(--danger); box-shadow: 0 0 20px rgba(255, 0, 85, 0.2); }
        
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* Mobile */
        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -280px; top: 0; height: 100%; z-index: 1000; transition: 0.3s; }
            .sidebar.show { left: 0; }
            .content { padding: 15px; width: 100%; }
            .menu-toggle { display: block !important; position: fixed; top: 15px; right: 15px; z-index: 1001; background: var(--primary); color: #000; border: none; padding: 10px; border-radius: 8px; box-shadow: 0 0 15px var(--primary); }
            .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 999; backdrop-filter: blur(3px); }
            .overlay.show { display: block; }
        }
        .menu-toggle { display: none; }
    </style>
</head>
<body>

    <button class="menu-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
    <div class="overlay" onclick="toggleSidebar()"></div>
    <div class="ai-toast-container" id="toastContainer"></div>

    <div class="sidebar" id="sidebar">
        <div class="brand">
            <i class="fas fa-robot"></i> ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
        </div>
        <div class="menu-item active" onclick="nav('dashboard')"><i class="fas fa-chart-pie"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</div>
        <div class="menu-item" onclick="nav('users')"><i class="fas fa-users"></i> ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
        <div class="menu-item" onclick="nav('mining')"><i class="fas fa-microchip"></i> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏∏‡∏î</div>
        <div class="menu-item" onclick="nav('shop')"><i class="fas fa-shopping-cart"></i> ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</div>
        <div class="menu-item" onclick="nav('referrals')">
            <i class="fas fa-user-friends"></i> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô 
            <span id="navReferralBadge" class="nav-badge" style="display:none;">0</span>
        </div>
        <div class="menu-item" onclick="nav('trans')" id="menuTrans">
            <i class="fas fa-exchange-alt"></i> ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° 
            <span id="navTransBadge" class="nav-badge" style="display:none;">0</span>
        </div>
        <div class="menu-item" onclick="nav('announce')"><i class="fas fa-bullhorn"></i> ‡∏£‡∏∞‡∏ö‡∏ö</div>

        <div style="margin-top: auto; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; border: 1px solid var(--border);">
            <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 8px;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</div>
            <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 8px; height: 8px; background: var(--success); border-radius: 50%; box-shadow: 0 0 8px var(--success);"></div>
                <span style="color: var(--success); font-weight: bold; font-size: 0.9rem;">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
            </div>
        </div>
    </div>

    <div class="content">
        
        <!-- Dashboard -->
        <div id="dashboard" class="section active">
            <h2><i class="fas fa-tachometer-alt"></i> ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 25px; margin-bottom: 30px;">
                
                <div class="card" style="border-left: 4px solid #10b981; margin: 0;">
                    <div style="font-size: 0.9rem; color: #94a3b8;">‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏£‡∏ß‡∏°</div>
                    <div style="font-size: 2rem; font-weight: bold; margin-top: 5px; color: #10b981; text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);" id="dashDeposit">‡∏ø0.00</div>
                    <i class="fas fa-arrow-down" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.1; color: #10b981;"></i>
                </div>

                <div class="card" style="border-left: 4px solid #ef4444; margin: 0;">
                    <div style="font-size: 0.9rem; color: #94a3b8;">‡∏¢‡∏≠‡∏î‡∏ñ‡∏≠‡∏ô‡∏£‡∏ß‡∏°</div>
                    <div style="font-size: 2rem; font-weight: bold; margin-top: 5px; color: #ef4444; text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);" id="dashWithdraw">‡∏ø0.00</div>
                    <i class="fas fa-arrow-up" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.1; color: #ef4444;"></i>
                </div>

                <div class="card" style="border-left: 4px solid #3b82f6; margin: 0;">
                    <div style="font-size: 0.9rem; color: #94a3b8;">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</div>
                    <div style="font-size: 2rem; font-weight: bold; margin-top: 5px; color: #3b82f6; text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);" id="dashNet">‡∏ø0.00</div>
                    <i class="fas fa-wallet" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.1; color: #3b82f6;"></i>
                </div>

                <div class="card" style="border-left: 4px solid #f59e0b; margin: 0;">
                    <div style="font-size: 0.9rem; color: #94a3b8;">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div style="font-size: 2rem; font-weight: bold; margin-top: 5px; color: #f59e0b; text-shadow: 0 0 10px rgba(245, 158, 11, 0.3);" id="dashUsers">0</div>
                    <i class="fas fa-users" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.1; color: #f59e0b;"></i>
                </div>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h3 style="margin: 0; color: var(--warning);"><i class="fas fa-tools"></i> ‡πÇ‡∏´‡∏°‡∏î‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</h3>
                        <p style="color: #94a3b8; margin: 5px 0 0;">‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ (‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="maintSwitch" onchange="toggleMaint()">
                        <span class="slider round"></span>
                    </label>
                </div>
                
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; border: 1px solid var(--border);">
                    <label style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 8px; display: block;">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</label>
                    <textarea id="maintMsg" class="search-bar" style="height: 80px; resize: none;" placeholder="‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤..."></textarea>
                    <button onclick="saveMaintMsg()" class="btn-sm btn-green" style="width: 100%; padding: 12px; margin-top: 10px;">
                        <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                    </button>
                </div>
            </div>
        </div>

        <!-- Users -->
        <div id="users" class="section">
            <h2><i class="fas fa-users"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
            <div class="card">
                <input type="text" id="searchUser" class="search-bar" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•..." onkeyup="filterUsers()">
                <div style="overflow-x: auto;">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                                <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                                <th>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏∏‡∏î</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Mining Rigs (User's Rigs) -->
        <div id="mining" class="section">
            <h2><i class="fas fa-server"></i> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
            <div class="card">
                <div style="overflow-x: auto;">
                    <table id="miningTable">
                        <thead>
                            <tr>
                                <th>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
                                <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß</th>
                                <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Shop Management -->
        <div id="shop" class="section">
            <h2><i class="fas fa-shopping-cart"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            
            <div class="card">
                <h3 style="color: var(--primary); margin-top: 0;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <input type="text" id="shopName" class="search-bar" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                    <input type="number" id="shopPrice" class="search-bar" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)">
                    <input type="number" id="shopSpeed" class="search-bar" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß (MH/s)">
                    <select id="shopIcon" class="search-bar">
                        <option value="fa-microchip">Microchip</option>
                        <option value="fa-server">Server</option>
                        <option value="fa-hdd">HDD</option>
                        <option value="fa-memory">Memory</option>
                        <option value="fa-fan">Fan</option>
                    </select>
                    <select id="shopTag" class="search-bar">
                        <option value="">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ó‡πá‡∏Å</option>
                        <option value="hot">HOT</option>
                        <option value="new">NEW</option>
                        <option value="sale">SALE</option>
                        <option value="best">BEST</option>
                        <option value="used">USED (‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á)</option>
                    </select>
                </div>
                <button onclick="addShopItem()" class="btn-sm btn-primary" style="width: 100%; padding: 12px; margin-top: 10px;">
                    <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô
                </button>
            </div>

            <div class="card">
                <h3 style="color: var(--primary); margin-top: 0;">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
                <div style="overflow-x: auto;">
                    <table id="shopTable">
                        <thead>
                            <tr>
                                <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                                <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß</th>
                                <th>‡πÅ‡∏ó‡πá‡∏Å</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3 style="color: var(--primary); margin-top: 0;">‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <textarea id="shopNotice" class="search-bar" placeholder="‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤..."></textarea>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <button onclick="saveShopNotice()" class="btn-sm btn-primary" style="flex:1; padding: 10px;">
                        <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                    </button>
                    <button onclick="disableShop()" class="btn-sm btn-red" style="flex:1; padding: 10px;">
                        <i class="fas fa-store-slash"></i> ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
                    </button>
                    <button onclick="enableShop()" class="btn-sm btn-green" style="flex:1; padding: 10px;">
                        <i class="fas fa-store"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô
                    </button>
                </div>
                <button onclick="clearShopItems()" class="btn-sm btn-red" style="width: 100%; padding: 12px;">
                    <i class="fas fa-trash"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
        </div>

        <!-- Referrals -->
        <div id="referrals" class="section">
            <h2><i class="fas fa-user-friends"></i> ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h2>
            <div class="card">
                <div style="overflow-x: auto;">
                    <table id="referralTable">
                        <thead>
                            <tr>
                                <th>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                                <th>‡∏ú‡∏π‡πâ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Transactions -->
        <div id="trans" class="section">
            <h2><i class="fas fa-exchange-alt"></i> ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</h2>
            <div class="card">
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button onclick="filterTrans('all')" class="btn-sm btn-primary">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button onclick="filterTrans('pending')" class="btn-sm btn-warning" style="background: #f59e0b;">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
                    <button onclick="filterTrans('approved')" class="btn-sm btn-green">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</button>
                    <button onclick="filterTrans('rejected')" class="btn-sm btn-red">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                </div>
                <div style="overflow-x: auto;">
                    <table id="transTable">
                        <thead>
                            <tr>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                                <th>‡∏™‡∏•‡∏¥‡∏õ/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Announcements -->
        <div id="announce" class="section">
            <h2><i class="fas fa-bullhorn"></i> ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h2>
            <div class="card">
                <textarea id="announceText" class="search-bar" style="height: 100px;" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®..."></textarea>
                <button onclick="postAnnounce()" class="btn-sm btn-primary" style="width: 100%; padding: 12px;">
                    <i class="fas fa-paper-plane"></i> ‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                </button>
                
                <div style="margin-top: 20px;">
                    <h3 style="color: var(--text-muted); font-size: 1rem;">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</h3>
                    <div id="currentAnnounce" style="padding: 15px; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 3px solid var(--primary); color: white;">
                        - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà -
                    </div>
                    <button onclick="clearAnnounce()" class="btn-sm btn-red" style="margin-top: 10px;">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</button>
                </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h3 style="color: var(--danger);"><i class="fas fa-trash-alt"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <p style="color: var(--text-muted);">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                <button onclick="resetSystem()" class="btn-sm btn-red" style="width: 100%; padding: 12px;">
                    ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
        </div>

    </div>

    <!-- Image Modal -->
    <div id="imgModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center; flex-direction: column;">
        <img id="modalImg" src="" style="max-width: 90%; max-height: 80vh; border: 2px solid var(--primary); box-shadow: 0 0 30px var(--primary); border-radius: 8px;">
        <button onclick="document.getElementById('imgModal').style.display='none'" class="btn-sm btn-red" style="margin-top: 20px; padding: 10px 30px; font-size: 1.2rem;">Close</button>
    </div>

    <script>

        // Navigation
        function nav(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            // Find the menu item that calls this function (simplified)
            event.currentTarget.classList.add('active');
            
            if(window.innerWidth <= 768) toggleSidebar();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('show');
            document.querySelector('.overlay').classList.toggle('show');
        }

        // Toast Notification
        function showToast(msg, type='info') {
            const c = document.getElementById('toastContainer');
            const t = document.createElement('div');
            t.className = `ai-toast ${type}`;
            
            let icon = 'info-circle';
            if(type === 'success') icon = 'check-circle';
            if(type === 'error') icon = 'times-circle';
            if(type === 'warning') icon = 'exclamation-triangle';
            
            t.innerHTML = `<i class="fas fa-${icon}" style="font-size: 1.2rem;"></i> <span>${msg}</span>`;
            c.appendChild(t);
            setTimeout(() => {
                t.style.animation = 'fadeOut 0.3s forwards';
                setTimeout(() => t.remove(), 300);
            }, 3000);
        }

        // --- LOGIC ---

        function getUsersList() {
            const raw = JSON.parse(localStorage.getItem('mining_users')) || {};
            if (Array.isArray(raw)) return raw;
            return Object.keys(raw).map(k => ({ username: k, ...raw[k] }));
        }

        function saveUsersRaw(raw) { localStorage.setItem('mining_users', JSON.stringify(raw)); }

        function getUserProfile(username) {
            return JSON.parse(localStorage.getItem(`pf_${username}`)) || { balance: 0, hashrate: 0.0 };
        }
        function saveUserProfile(username, pf) { localStorage.setItem(`pf_${username}`, JSON.stringify(pf)); }

        // Dashboard
        function renderDashboard() {
            const users = getUsersList();
            const trans = JSON.parse(localStorage.getItem('mining_transactions')) || [];
            
            let deposit = 0;
            let withdraw = 0;
            
            trans.forEach(t => {
                if(t.status === 'approved') {
                    if(t.type === 'deposit') deposit += parseFloat(t.amount);
                    if(t.type === 'withdraw') withdraw += parseFloat(t.amount);
                }
            });

            document.getElementById('dashDeposit').innerText = '‡∏ø' + deposit.toLocaleString();
            document.getElementById('dashWithdraw').innerText = '‡∏ø' + withdraw.toLocaleString();
            document.getElementById('dashNet').innerText = '‡∏ø' + (deposit - withdraw).toLocaleString();
            document.getElementById('dashUsers').innerText = users.length;
        }

        // Users
        function renderUsers() {
            const users = getUsersList();
            const tb = document.querySelector('#usersTable tbody');
            tb.innerHTML = '';
            
            users.forEach(u => {
                // Count rigs
                let rigs = JSON.parse(localStorage.getItem(`mining_rigs_${u.username}`)) || [];
                
                let tr = document.createElement('tr');
                const pf = getUserProfile(u.username);
                tr.innerHTML = `
                    <td>
                        <div style="font-weight:bold; color: white;">${u.username}</div>
                        <div style="font-size:0.8rem; color: #94a3b8;">${u.email || '-'}</div>
                    </td>
                    <td style="color: #10b981; font-weight: bold;">‡∏ø${parseFloat(pf.balance || 0).toLocaleString()}</td>
                    <td>${rigs.length}</td>
                    <td><span class="badge badge-success">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</span></td>
                    <td>
                        <button onclick="deleteUser('${u.username}')" class="btn-sm btn-red"><i class="fas fa-trash"></i></button>
                        <button onclick="resetPass('${u.username}')" class="btn-sm btn-warning" style="background: #f59e0b;"><i class="fas fa-key"></i></button>
                    </td>
                `;
                tb.appendChild(tr);
            });
        }

            function deleteUser(username) {
            if(confirm('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ' + username + ' ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                let raw = JSON.parse(localStorage.getItem('mining_users')) || {};
                if (Array.isArray(raw)) { 
                    raw = raw.filter(u => u.username !== username); 
                } else { 
                    delete raw[username]; 
                }
                saveUsersRaw(raw);
                localStorage. removeItem(`mining_rigs_${username}`);
                localStorage.removeItem(`notifications_${username}`);
                localStorage.removeItem(`pf_${username}`);
                localStorage.removeItem(`mining_referrals_${username}`);
                localStorage.removeItem(`active_items_${username}`);
                
                // üî¥ Broadcast to all tabs/App
                syncManager.broadcast('user_deleted', { 
                    username: username,
                    timestamp: Date.now()
                });
                syncManager.emitLocal('user_deleted', { username });
                
                renderUsers();
                renderDashboard();
                showToast('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }
        
               function resetPass(username) {
            let newPass = prompt('‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ' + username + ':');
            if(newPass) {
                let raw = JSON. parse(localStorage.getItem('mining_users')) || {};
                if (Array.isArray(raw)) {
                    let idx = raw.findIndex(u => u. username === username);
                    if(idx !== -1) { raw[idx].password = newPass; raw[idx].pass = newPass; }
                } else {
                    if (! raw[username]) raw[username] = {};
                    raw[username]. password = newPass;
                    raw[username].pass = newPass;
                }
                saveUsersRaw(raw);
                
                // üî¥ Notify user
                let notifs = JSON.parse(localStorage.getItem(`notifications_${username}`)) || [];
                notifs. push({
                    id: Date.now(),
                    msg: '‚ö†Ô∏è ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß',
                    type: 'warning',
                    timestamp: Date.now(),
                    read: false
                });
                localStorage.setItem(`notifications_${username}`, JSON.stringify(notifs));
                
                syncManager.broadcast('password_reset', { username });
                
                showToast('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        } 

        // User Rigs (View Only)
        function renderMining() {
            const users = getUsersList();
            const tb = document.querySelector('#miningTable tbody');
            tb.innerHTML = '';
            
            users.forEach(u => {
                let rigs = JSON.parse(localStorage.getItem(`mining_rigs_${u.username}`)) || [];
                const lastActive = parseInt(localStorage.getItem(`last_active_${u.username}`) || '0');
                const online = (Date.now() - lastActive) < 60000;
                
                rigs.forEach((r, idx) => {
                    let tr = document.createElement('tr');
                    
                    // Time Remaining Logic
                    const now = Date.now();
                    const expiresAt = r.expiresAt || (r.timestamp + 24 * 60 * 60 * 1000);
                    const diff = expiresAt - now;
                    
                    let timeLabel = '';
                    if(diff <= 0) {
                        timeLabel = '<span style="color: #ef4444;">‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤</span>';
                    } else {
                        const h = Math.floor(diff / (1000 * 60 * 60));
                        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        timeLabel = `${h} ‡∏ä‡∏°. ${m} ‡∏ô.`;
                    }

                    const statusLabel = (r.status === 'expired' || diff <= 0) ? '<span class="badge badge-danger">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>' : '<span class="badge badge-success">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>';
                    const connDot = online ? '<span class="badge badge-success">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>' : '<span class="badge badge-warning">‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</span>';
                    
                    tr.innerHTML = `
                        <td>${u.username}</td>
                        <td>${r.name}</td>
                        <td>${r.speed} MH/s</td>
                        <td>${timeLabel}</td>
                        <td>${statusLabel}</td>
                        <td>${connDot}</td>
                        <td>
                            <button class="btn-sm btn-green" onclick="renewRig('${u.username}', ${idx})">‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏</button>
                            <button class="btn-sm btn-red" onclick="deleteRig('${u.username}', ${r.id})">‡∏•‡∏ö</button>
                        </td>
                    `;
                    tb.appendChild(tr);
                });
            });
        }

        function renewRig(username, idx) {
            if(!confirm('‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á?')) return;
            
            let rigs = JSON.parse(localStorage.getItem(`mining_rigs_${username}`)) || [];
            if(rigs[idx]) {
                const now = Date.now();
                rigs[idx].timestamp = now;
                rigs[idx].expiresAt = now + (24 * 60 * 60 * 1000);
                rigs[idx].status = 'active';
                localStorage.setItem(`mining_rigs_${username}`, JSON.stringify(rigs));
                
                // Also try to update active_items for logic consistency
                let active = JSON.parse(localStorage.getItem(`active_items_${username}`)) || [];
                let activeIdx = active.findIndex(a => a.id === rigs[idx].id);
                if(activeIdx !== -1) {
                    active[activeIdx].expiresAt = now + (24 * 60 * 60 * 1000);
                    localStorage.setItem(`active_items_${username}`, JSON.stringify(active));
                }

                showToast('‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                renderMining();
            }
        }
        
        function deleteRig(user, id) {
            if(confirm('‡∏•‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                let rigs = JSON.parse(localStorage.getItem(`mining_rigs_${user}`)) || [];
                rigs = rigs.filter(r => r.id !== id);
                localStorage.setItem(`mining_rigs_${user}`, JSON.stringify(rigs));
                renderMining();
                showToast('‡∏•‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        // Shop
        function renderShop() {
            const items = JSON.parse(localStorage.getItem('mining_shop_items')) || [];
            const tb = document.querySelector('#shopTable tbody');
            tb.innerHTML = '';
            
            items.forEach(i => {
                let tr = document.createElement('tr');
                let tagBadge = i.tag ? `<span class="badge badge-info">${i.tag}</span>` : '-';
                if(i.tag === 'used') tagBadge = `<span class="badge badge-warning" style="border-color: #cd7f32; color: #cd7f32;">USED</span>`;
                
                tr.innerHTML = `
                    <td><i class="fas ${i.icon}" style="margin-right: 5px; color: var(--primary);"></i> ${i.name}</td>
                    <td>‡∏ø${i.price.toLocaleString()}</td>
                    <td>${i.speed} MH/s</td>
                    <td>${tagBadge}</td>
                    <td>
                        <button onclick="deleteShopItem(${i.id})" class="btn-sm btn-red"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tb.appendChild(tr);
            });
        }

        function addShopItem() {
            const name = document.getElementById('shopName').value;
            const price = parseFloat(document.getElementById('shopPrice').value);
            const speed = parseFloat(document.getElementById('shopSpeed').value);
            const icon = document.getElementById('shopIcon').value;
            const tag = document.getElementById('shopTag').value;

            if(name && !isNaN(price) && !isNaN(speed)) {
                let items = JSON.parse(localStorage.getItem('mining_shop_items')) || [];
                items.push({ id: Date.now(), name, price, speed, icon, tag });
                localStorage.setItem('mining_shop_items', JSON.stringify(items));
                localStorage.setItem('shop_last_update', String(Date.now()));
                
                renderShop();
                showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß', 'success');
                
                // Clear inputs
                document.getElementById('shopName').value = '';
                document.getElementById('shopPrice').value = '';
                document.getElementById('shopSpeed').value = '';
            } else {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            }
        }

        function deleteShopItem(id) {
            if(confirm('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                let items = JSON.parse(localStorage.getItem('mining_shop_items')) || [];
                items = items.filter(i => i.id !== id);
                localStorage.setItem('mining_shop_items', JSON.stringify(items));
                localStorage.setItem('shop_last_update', String(Date.now()));
                renderShop();
                showToast('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        // Referrals
        function renderReferrals() {
            const refs = JSON.parse(localStorage.getItem('mining_referrals_pending')) || [];
            const tb = document.querySelector('#referralTable tbody');
            tb.innerHTML = '';
            
            document.getElementById('navReferralBadge').style.display = refs.length > 0 ? 'inline-block' : 'none';
            document.getElementById('navReferralBadge').innerText = refs.length;

            refs.forEach(r => {
                let tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${r.user}</td>
                    <td>${r.referrer}</td>
                    <td>${new Date(r.date).toLocaleDateString()}</td>
                    <td>
                        <button onclick="approveRef('${r.id}', true)" class="btn-sm btn-green">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                        <button onclick="approveRef('${r.id}', false)" class="btn-sm btn-red">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                    </td>
                `;
                tb.appendChild(tr);
            });
        }
        
        function approveRef(id, approved) {
            let refs = JSON.parse(localStorage.getItem('mining_referrals_pending')) || [];
            let idx = refs.findIndex(r => r.id === id);
            if(idx !== -1) {
                let ref = refs[idx];
                if(approved) {
                    // Logic to reward referrer
                    // For now just mark accepted
                }
                refs.splice(idx, 1);
                localStorage.setItem('mining_referrals_pending', JSON.stringify(refs));
                renderReferrals();
                showToast(approved ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏•‡πâ‡∏ß' : '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏•‡πâ‡∏ß', approved ? 'success' : 'info');
            }
        }

        function saveShopNotice() {
            const txt = document.getElementById('shopNotice').value || '';
            localStorage.setItem('shop_notice', txt);
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }
        function disableShop() {
            localStorage.setItem('shop_disabled', 'true');
            showToast('‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß', 'warning');
        }
        function enableShop() {
            localStorage.setItem('shop_disabled', 'false');
            showToast('‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }
        function clearShopItems() {
            localStorage.setItem('mining_shop_items', JSON.stringify([]));
            localStorage.setItem('shop_seeded', 'true');
            localStorage.setItem('shop_last_update', String(Date.now()));
            renderShop();
            showToast('‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        // Transactions
        let currentTransFilter = 'all';
        function filterTrans(status) {
            currentTransFilter = status;
            renderTrans();
        }

        function renderTrans() {
            let trans = JSON.parse(localStorage.getItem('mining_transactions')) || [];
            trans.sort((a, b) => b.date - a.date); // Newest first
            
            const tb = document.querySelector('#transTable tbody');
            tb.innerHTML = '';

            let pendingCount = 0;

            trans.forEach(t => {
                if(t.status === 'pending') pendingCount++;
                if(currentTransFilter !== 'all' && t.status !== currentTransFilter) return;

                let statusBadge = '';
                if(t.status === 'pending') statusBadge = '<span class="badge badge-warning">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>';
                else if(t.status === 'approved') statusBadge = '<span class="badge badge-success">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>';
                else if(t.status === 'rejected') statusBadge = '<span class="badge badge-danger">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</span>';

                let actionBtns = '';
                if(t.status === 'pending') {
                    actionBtns = `
                        <button onclick="approveTrans(${t.id}, 'approved')" class="btn-sm btn-green"><i class="fas fa-check"></i></button>
                        <button onclick="approveTrans(${t.id}, 'rejected')" class="btn-sm btn-red"><i class="fas fa-times"></i></button>
                    `;
                }

                let slipLink = t.slip ? `<button onclick="viewSlip('${t.slip}')" class="btn-sm btn-primary"><i class="fas fa-image"></i> ‡∏î‡∏π</button>` : '-';

                let tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${new Date(t.date).toLocaleString()}</td>
                    <td style="font-weight: bold; color: white;">${t.user}</td>
                    <td style="text-transform: uppercase; color: ${t.type==='deposit'?'#10b981':'#ef4444'}">${t.type}</td>
                    <td style="font-weight: bold;">‡∏ø${parseFloat(t.amount).toLocaleString()}</td>
                    <td>${slipLink}</td>
                    <td>${statusBadge}</td>
                    <td>${actionBtns}</td>
                `;
                tb.appendChild(tr);
            });
            
            document.getElementById('navTransBadge').style.display = pendingCount > 0 ? 'inline-block' : 'none';
            document.getElementById('navTransBadge').innerText = pendingCount;
        }

        function approveTrans(id, status) {
            let trans = JSON.parse(localStorage.getItem('mining_transactions'));
            let idx = trans.findIndex(t => t.id === id);
            if(idx !== -1) {
                trans[idx].status = status;
                
                if(status === 'approved') {
                    const pf = getUserProfile(trans[idx].user);
                    if(trans[idx].type === 'deposit') {
                        pf.balance = parseFloat(pf.balance || 0) + parseFloat(trans[idx].amount);
                        saveUserProfile(trans[idx].user, pf);
                    }
                } else if (status === 'rejected') {
                     // Refund if withdraw was rejected
                     if(trans[idx].type === 'withdraw') {
                        const pf = getUserProfile(trans[idx].user);
                        pf.balance = parseFloat(pf.balance || 0) + parseFloat(trans[idx].amount);
                        saveUserProfile(trans[idx].user, pf);
                     }
                }

                localStorage.setItem('mining_transactions', JSON.stringify(trans));
                
                // Notification to User
                const user = trans[idx].user;
                const type = status === 'approved' ? 'success' : 'error';
                const msg = status === 'approved' 
                    ? `‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° ${trans[idx].type.toUpperCase()} ‡∏ø${parseFloat(trans[idx].amount).toLocaleString()} ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß!` 
                    : `‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏° ${trans[idx].type.toUpperCase()} ‡∏ø${parseFloat(trans[idx].amount).toLocaleString()} ‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò`;

                let notifs = JSON.parse(localStorage.getItem(`notifications_${user}`)) || [];
                notifs.push({
                    id: Date.now(),
                    msg: msg,
                    type: type,
                    timestamp: Date.now(),
                    read: false
                });
                localStorage.setItem(`notifications_${user}`, JSON.stringify(notifs));

                renderTrans();
                renderDashboard();
                showToast(`‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏õ‡πá‡∏ô ${status.toUpperCase()}`, 'success');
            }
        }
        
        function viewSlip(url) {
            document.getElementById('modalImg').src = url;
            document.getElementById('imgModal').style.display = 'flex';
        }

        // Announcements & System
            function postAnnounce() {
                const txt = document.getElementById('announceText').value;
                if(txt) {
                const annObj = { msg: txt, date: new Date().toISOString() };
                localStorage.setItem('mining_announcement', JSON.stringify(annObj));
                document.getElementById('currentAnnounce').innerText = txt;
                document.getElementById('announceText').value = '';
                
                // üî¥ Broadcast to all apps
                syncManager.broadcast('announcement_posted', annObj);
                syncManager. emitLocal('announcement_posted', annObj);
                
                showToast('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }
        
                function clearAnnounce() {
    localStorage.removeItem('mining_announcement');
    document.getElementById('currentAnnounce').innerText = '- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà -';
    
    // üî¥ Broadcast to all apps
    syncManager.broadcast('announcement_cleared', { timestamp: Date.now() });
    syncManager.emitLocal('announcement_cleared', {});
    
    showToast('‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡πâ‡∏ß', 'info');
}

                function toggleMaint() {
            const isMaint = document.getElementById('maintSwitch').checked;
            localStorage.setItem('mining_maintenance', isMaint);
            
            // üî¥ Broadcast to all apps
            syncManager.broadcast('maintenance_mode_changed', { 
                enabled: isMaint,
                timestamp: Date.now()
            });
            syncManager.emitLocal('maintenance_mode_changed', { enabled: isMaint });
            
            showToast(isMaint ? '‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤' : '‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤', isMaint ? 'warning' : 'info');
        }
        
                function saveMaintMsg() {
            const msg = document. getElementById('maintMsg').value;
            localStorage.setItem('mining_maintenance_msg', msg);
            
            // üî¥ Broadcast to all apps
            syncManager.broadcast('maintenance_msg_changed', { 
                message: msg,
                timestamp: Date.now()
            });
            
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }
        
        function resetSystem() {
            if(confirm('‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î! ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                localStorage.clear();
                location.reload();
            }
        }
        // ============ ADMIN LIVE SYNC ============
liveSync.on('users', (data) => {
    console. log('üì° Users updated from app');
    renderUsers();
    renderDashboard();
});

liveSync.on('transactions', (data) => {
    console.log('üì° Transactions updated from app');
    renderTrans();
    renderDashboard();
});

liveSync.on('shop', (data) => {
    console.log('üì° Shop updated from app');
    renderShop();
});

liveSync.on('maintenance', (data) => {
    console.log('üì° Maintenance status updated');
    const isMaint = localStorage.getItem('mining_maintenance') === 'true';
    document.getElementById('maintSwitch').checked = isMaint;
});

liveSync.on('announcement', (data) => {
    console.log('üì° Announcement updated from app');
    const ann = localStorage.getItem('mining_announcement');
    if(ann) {
        document.getElementById('currentAnnounce').innerText = JSON.parse(ann). msg;
    }
});

liveSync.on('profile_updated', (data) => {
    console.log('üì° Profile updated:', data.username);
    renderUsers();
    renderDashboard();
});

liveSync.on('referrals_updated', (data) => {
    console.log('üì° Referral updated:', data.username);
    renderReferrals();
});

// Auto refresh admin dashboard
setInterval(() => {
    if (document.querySelector('.section. active')) {
        const activeSection = document.querySelector('.section. active'). id;
        
        switch(activeSection) {
            case 'dashboard':
                renderDashboard();
                break;
            case 'users':
                renderUsers();
                break;
            case 'trans':
                renderTrans();
                break;
            case 'mining':
                renderMining();
                break;
            case 'shop':
                renderShop();
                break;
            case 'referrals':
                renderReferrals();
                break;
        }
    }
}, 2000);

console.log('‚úÖ Admin Live Sync listeners registered');
        // Init
        window.onload = function() {
            renderDashboard();
            renderUsers();
            renderMining();
            renderShop();
            renderReferrals();
            renderTrans();
            
            const ann = localStorage.getItem('mining_announcement');
            if(ann) document.getElementById('currentAnnounce').innerText = ann;
            
            const maint = localStorage.getItem('mining_maintenance') === 'true';
            document.getElementById('maintSwitch').checked = maint;
            
            const maintMsg = localStorage.getItem('mining_maintenance_msg');
            if(maintMsg) document.getElementById('maintMsg').value = maintMsg;

            // Auto refresh trans
            setInterval(() => {
                renderTrans();
                renderReferrals();
            }, 5000);
        };
                // ============ ADMIN SYNC LISTENERS ============
        document.addEventListener('DOMContentLoaded', function() {
            // Listen for forced sync from other tabs
            syncManager.on('force_sync_requested', () => {
                console.log('Force sync requested, reloading data');
                renderDashboard();
                renderUsers();
                renderMining();
                renderShop();
                renderReferrals();
                renderTrans();
            });

            // Monitor transaction updates from other tabs
            syncManager.on('transactions_updated', (trans) => {
                console.log('Transactions updated from external source');
                renderTrans();
                renderDashboard();
            });

            // Monitor user updates
            syncManager.on('users_updated', (users) => {
                console.log('Users updated from external source');
                renderUsers();
                renderDashboard();
            });

            // Monitor shop updates
            syncManager.on('shop_updated', () => {
                console.log('Shop updated from external source');
                renderShop();
            });

            console.log('‚úÖ Admin Sync Listeners Registered');
            console.log('Sync Manager Debug:', syncManager.debugInfo());
        });
    </script>
</body>
</html>
